---
title: "Power_analysis_Prelims"
author: "Amy Fox"
date: "10/7/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(stats)
```

# Aim 1.1

**Note: This sample size is required because I'm comparing placenta and amniotic fluid - if I'm looking at fetal lungs etc. I would technically only need 1 pregnant mouse per group, because the average litter size is 6-8**

Two-sample power analysis
H0: mu(aerosol) = mu(non-aerosol)
HA: mu(aerosol) = mu(non-aerosol)

n = ?
delta = 5 (conjectured uA-u0)
sd = 2 (conjectured sd)
sig.level = 0.05
power = 0.9
alternative = two.sided
```{r}
power.t.test(power = 0.9, delta = 5, sd = 2, sig.level = 0.05, alternative = "two.sided", type = "one.sample")
```
# Aim 1.2 
For the correlation coefficients:
(online calculator for Spearman specifically, n = 11.5 --> round up to 12)

Using 4 groups 4 mice per group, 5 timepoints
Plot with the smallest 
```{r}
library(pwr)
pwr.r.test(n = 16, r = 0.8, sig.level = 0.05)
pwr.r.test(r = 0.8, sig.level = 0.05, p = 0.9)
```

Redo the calculations because now using one-sample, two-sided Mann-Whitney
H0: mu = 0
HA: mu $\neq$ 0 



```{r}
library(wmwpow)
wmwpowd(n = 5, m = 0, distn = 5, distm = 0, sides = "two.sided")
```

# Aim 2

Power test for 2.1 (testing presence of microbiota)
```{r}
power.t.test(delta = 10, sd = 4, power = 0.9, alternative = "one.sided")
```


OTU counts: 
```{r}
library(readxl)
sample_micro <- read_xlsx("../Data/data_from_microbiome_paper.xlsx")

lm_fit <- lm(OTUs ~ Sample, data = sample_micro)

# withing-group variance
anova(lm_fit)["Residuals", "Mean Sq"]

anova(lm_fit)["group", "Mean Sq"]


C <- sample_micro %>%
  filter(Sample == "C1" | Sample == "C2" | Sample == "C3" | Sample == "C4" | Sample == "C5") %>%
  mutate(within_C = var(OTUs))

B <- sample_micro %>%
  filter(Sample == "B1" | Sample == "B2" | Sample == "B3" | Sample == "B4" | Sample == "B5") %>%
  mutate(within_B = var(OTUs)) 

M <- sample_micro %>%
  filter(Sample == "M1" | Sample == "M2" | Sample == "M3" | Sample == "M4" | Sample == "M5") %>%
  mutate(within_M = var(OTUs)) 

C
B
M

# within variance
mean(361737.3, 114828.3, 43546.3)



power.anova.test(groups = 4, between.var = 3617370, within.var = 361737, sig.level = 0.05, power = 0.9)
```


```{r}
flow_data %>%
 group_by(Organ, Group) %>%
  nest() %>%
  mutate(aov_result = map(data, ~aov(pop_percent ~ Group, data = .x)),
         tukey_result = map(aov_result, TukeyHSD),
         tidy_tukey = map(tukey_result, tidy)) %>%
  unnest(tidy_tukey, .drop = TRUE)
```


Example Data for 1.2
```{r}

library(ggplot2)
# Plots 1: Deposition vs. Dose

plot1_data <- data.frame(Group = c(rep("Group1", 5), rep("Group2", 5), rep("Group3",5), rep("Group4", 5)),
           Deposition = c(runif(5, 0, 3), runif(5, 1, 5), runif(5, 2, 10), runif(5, 10, 50)))

ggplot(plot1_data, aes(x = Group, y = Deposition, color = Group)) +
  geom_point() +
  ggtitle("Example Data: Maternal Plasma Deposition at 24 hours (n = 20)")

# Plots 2: Concentration vs. Time

plot2_data <- data.frame(Timepoint= c(rep(0, 5), rep(24, 5), rep(48,5), rep(7*24, 5), rep(14*24, 5)),
           Concentration = c(runif(5, 10, 20), runif(5, 20, 50), runif(5, 10, 30), runif(5, 5, 10), runif(5, 0,7)))


ggplot(plot2_data, aes(x = Timepoint, y = Concentration, color = Timepoint)) +
  geom_point() +
  xlab("Timepoint (hrs)") +
  ggtitle("Example Data: Maternal Plasma Concentration Over Time (n = 25)")
```

